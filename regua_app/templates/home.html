{% extends 'base.html' %}

{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
  <div>
    <h2 class="mb-1">Visão Geral</h2>
    <p class="text-muted mb-0">Acompanhe os cadastros da régua de comunicação e navegue rapidamente pelos formulários.</p>
  </div>
  <div class="btn-toolbar" role="toolbar">
    <div class="btn-group me-2">
      <a class="btn btn-primary" href="{{ url_for('routes.nova_jornada') }}"><i class="fa-solid fa-route me-2"></i>Nova Jornada</a>
      <a class="btn btn-primary" href="{{ url_for('routes.novo_tema') }}"><i class="fa-solid fa-book-medical me-2"></i>Novo Tema</a>
      <a class="btn btn-primary" href="{{ url_for('routes.novo_regra') }}"><i class="fa-solid fa-gavel me-2"></i>Nova Regra</a>
    </div>
    <div class="btn-group">
      <a class="btn btn-gold" href="{{ url_for('routes.novo_tema_regra') }}"><i class="fa-solid fa-link me-2"></i>Vincular Tema–Regra</a>
      <a class="btn btn-gold" href="{{ url_for('routes.novo_dia') }}"><i class="fa-solid fa-calendar-plus me-2"></i>Adicionar Dia</a>
    </div>
  </div>
</div>

<div class="accordion" id="overviewAccordion">
  <div class="accordion-item border-0 shadow-sm rounded-4 mb-3">
    <h2 class="accordion-header" id="headingJornadas">
      <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#jornadasCollapse" aria-expanded="true" aria-controls="jornadasCollapse">
        <i class="fa-solid fa-route me-2 text-primary"></i>
        Jornadas cadastradas <span class="badge bg-light text-dark ms-2">{{ jornadas|length }}</span>
      </button>
    </h2>
    <div id="jornadasCollapse" class="accordion-collapse collapse show" aria-labelledby="headingJornadas" data-bs-parent="#overviewAccordion">
      <div class="accordion-body">
        {% if jornadas %}
        <div class="table-wrap">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Nome</th>
                <th scope="col">Descrição</th>
                <th scope="col">Temas vinculados</th>
                <th scope="col" class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for j in jornadas %}
              <tr>
                <td><span class="badge badge-id">#{{ j.id }}</span></td>
                <td class="fw-semibold">{{ j.nome }}</td>
                <td class="text-muted">{{ j.descricao or '—' }}</td>
                <td class="text-muted">{{ j.temas|length }}</td>
                <td class="text-end">
                  <div class="btn-group btn-group-sm" role="group">
                    <a class="btn btn-outline-primary" href="{{ url_for('routes.editar_jornada', jornada_id=j.id) }}"><i class="fa-solid fa-pen"></i></a>
                    <form action="{{ url_for('routes.deletar_jornada', jornada_id=j.id) }}" method="post" class="m-0" onsubmit="return confirm('Excluir jornada? Temas permanecerão cadastrados, mas sem jornada associada.');">
                      <button type="submit" class="btn btn-outline-danger"><i class="fa-solid fa-trash"></i></button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">Nenhuma jornada cadastrada até o momento.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="accordion-item border-0 shadow-sm rounded-4 mb-3">
    <h2 class="accordion-header" id="headingTemas">
      <button class="accordion-button fw-semibold collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#temasCollapse" aria-expanded="false" aria-controls="temasCollapse">
        <i class="fa-solid fa-book-open me-2 text-primary"></i>
        Temas cadastrados <span class="badge bg-light text-dark ms-2">{{ temas|length }}</span>
      </button>
    </h2>
    <div id="temasCollapse" class="accordion-collapse collapse" aria-labelledby="headingTemas" data-bs-parent="#overviewAccordion">
      <div class="accordion-body">
        {% if temas %}
        <div class="table-wrap">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Nome</th>
                <th scope="col">Jornada</th>
                <th scope="col">Descrição</th>
                <th scope="col">Objetivo</th>
                <th scope="col" class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for t in temas %}
              <tr>
                <td><span class="badge badge-id">#{{ t.id }}</span></td>
                <td class="fw-semibold">{{ t.nome }}</td>
                <td class="text-muted">{{ t.jornada.nome if t.jornada else '—' }}</td>
                <td class="text-muted">{{ t.descricao or '—' }}</td>
                <td class="text-muted">{{ t.objetivo or '—' }}</td>
                <td class="text-end">
                  <div class="btn-group btn-group-sm" role="group">
                    <a class="btn btn-outline-primary" href="{{ url_for('routes.editar_tema', tema_id=t.id) }}"><i class="fa-solid fa-pen"></i></a>
                    <form action="{{ url_for('routes.deletar_tema', tema_id=t.id) }}" method="post" class="m-0" onsubmit="return confirm('Excluir tema? Esta ação removerá vínculos e dias relacionados.');">
                      <button type="submit" class="btn btn-outline-danger"><i class="fa-solid fa-trash"></i></button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">Nenhum tema cadastrado até o momento.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="accordion-item border-0 shadow-sm rounded-4 mb-3">
    <h2 class="accordion-header" id="headingRegras">
      <button class="accordion-button fw-semibold collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#regrasCollapse" aria-expanded="false" aria-controls="regrasCollapse">
        <i class="fa-solid fa-scale-balanced me-2 text-primary"></i>
        Regras cadastradas <span class="badge bg-light text-dark ms-2">{{ regras|length }}</span>
      </button>
    </h2>
    <div id="regrasCollapse" class="accordion-collapse collapse" aria-labelledby="headingRegras" data-bs-parent="#overviewAccordion">
      <div class="accordion-body">
        {% if regras %}
        <div class="table-wrap">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Descrição</th>
                <th scope="col" class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for r in regras %}
              <tr>
                <td><span class="badge badge-id">#{{ r.id }}</span></td>
                <td class="text-muted">{{ r.descricao }}</td>
                <td class="text-end">
                  <div class="btn-group btn-group-sm" role="group">
                    <a class="btn btn-outline-primary" href="{{ url_for('routes.editar_regra', regra_id=r.id) }}"><i class="fa-solid fa-pen"></i></a>
                    <form action="{{ url_for('routes.deletar_regra', regra_id=r.id) }}" method="post" class="m-0" onsubmit="return confirm('Excluir regra? Esta ação removerá vínculos e dias relacionados.');">
                      <button type="submit" class="btn btn-outline-danger"><i class="fa-solid fa-trash"></i></button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">Nenhuma regra cadastrada ainda.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="accordion-item border-0 shadow-sm rounded-4 mb-3">
    <h2 class="accordion-header" id="headingVinculos">
      <button class="accordion-button fw-semibold collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#vinculosCollapse" aria-expanded="false" aria-controls="vinculosCollapse">
        <i class="fa-solid fa-diagram-project me-2 text-primary"></i>
        Vínculos Tema–Regra <span class="badge bg-light text-dark ms-2">{{ temas_regras|length }}</span>
      </button>
    </h2>
    <div id="vinculosCollapse" class="accordion-collapse collapse" aria-labelledby="headingVinculos" data-bs-parent="#overviewAccordion">
      <div class="accordion-body">
        {% if temas_regras %}
        <div class="table-wrap">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Tema</th>
                <th scope="col">Jornada</th>
                <th scope="col">Regra</th>
                <th scope="col">Comunicação alternativa</th>
                <th scope="col" class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for tr in temas_regras %}
              <tr>
                <td><span class="badge badge-id">#{{ tr.id }}</span></td>
                <td class="fw-semibold">{{ tr.tema.nome }}</td>
                <td class="text-muted">{{ tr.tema.jornada.nome if tr.tema and tr.tema.jornada else '—' }}</td>
                <td class="text-muted">{{ tr.regra.descricao }}</td>
                <td>
                  {% if tr.alternativa %}
                  <span class="badge bg-secondary-subtle text-dark">{{ tr.alternativa.tema.nome }} / {{ tr.alternativa.regra.descricao }}</span>
                  {% else %}
                  <span class="text-muted">Nenhuma</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <div class="btn-group btn-group-sm" role="group">
                    <a class="btn btn-outline-primary" href="{{ url_for('routes.editar_tema_regra', tr_id=tr.id) }}"><i class="fa-solid fa-pen"></i></a>
                    <form action="{{ url_for('routes.deletar_tema_regra', tr_id=tr.id) }}" method="post" class="m-0" onsubmit="return confirm('Excluir vínculo? Esta ação removerá dias relacionados.');">
                      <button type="submit" class="btn btn-outline-danger"><i class="fa-solid fa-trash"></i></button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">Nenhum vínculo cadastrado.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="accordion-item border-0 shadow-sm rounded-4">
    <h2 class="accordion-header" id="headingDias">
      <button class="accordion-button fw-semibold collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#diasCollapse" aria-expanded="false" aria-controls="diasCollapse">
        <i class="fa-solid fa-calendar-days me-2 text-primary"></i>
        Dias de Comunicação <span class="badge bg-light text-dark ms-2">{{ dias|length }}</span>
      </button>
    </h2>
    <div id="diasCollapse" class="accordion-collapse collapse" aria-labelledby="headingDias" data-bs-parent="#overviewAccordion">
      <div class="accordion-body">
        {% if dias %}
        <div class="table-wrap">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Dia</th>
                <th scope="col">Vínculo Tema–Regra</th>
                <th scope="col">Jornada</th>
                <th scope="col" class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for d in dias %}
              <tr>
                <td><span class="badge badge-id">#{{ d.id }}</span></td>
                <td class="fw-semibold">Dia {{ d.dia }}</td>
                <td class="text-muted">{{ d.tema_regra.tema.nome }} / {{ d.tema_regra.regra.descricao }}</td>
                <td class="text-muted">
                  {% if d.tema_regra.tema.jornada %}
                    {{ d.tema_regra.tema.jornada.nome }}
                  {% elif d.jornada_nome %}
                    {{ d.jornada_nome }}
                  {% else %}
                    —
                  {% endif %}
                </td>
                <td class="text-end">
                  <div class="btn-group btn-group-sm" role="group">
                    <a class="btn btn-outline-primary" href="{{ url_for('routes.editar_dia', dia_id=d.id) }}"><i class="fa-solid fa-pen"></i></a>
                    <form action="{{ url_for('routes.deletar_dia', dia_id=d.id) }}" method="post" class="m-0" onsubmit="return confirm('Excluir dia?');">
                      <button type="submit" class="btn btn-outline-danger"><i class="fa-solid fa-trash"></i></button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">Nenhum dia configurado.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}